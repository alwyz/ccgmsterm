.OPT ERR        ;NO LIST!!!MODREG = $DD01DATDIR = $DD03RDTIM  = $FFDEFRMEVL = $AD9EOUTNUM = $BDCDNMIVEC = $0318STATUS = $90LOGNUM = $05MODEM  = $02SECADR = $03SETLFS = $FFBASETNAM = $FFBDOPEN   = $FFC0CHKIN  = $FFC6CHKOUT = $FFC9CHRIN  = $FFCFCHROUT = $FFD2GETIN  = $FFE4CLOSE  = $FFC3CLRCHN = $FFCCCLALL  = $FFE7READST = $FFB7PLOT   = $FFF0LISTEN = $FFB1SECOND = $FF93TALK   = $FFB4TKSA   = $FF96UNLSN  = $FFAEUNTLK  = $FFABACPTR  = $FFA5CIOUT  = $FFA8NUMFIL = $98LOCAT  = $FBNLOCAT = $FDXMOBUF = $FDINPBUF = $0200BACKGR = $D021BORDER = $D020TEXTCL = 646CLCODE = $E8DASCRTOP = 648LINE   = 214COLUMN = 211LLEN   = 213QMODE  = 212IMODE  = 216BCOLOR = 0TCOLOR = 15CURSOR = 95    ;CURSOR "_"LEFT   = $9DCURSFL = $FEBUFFST = $B2BUFPTR = $B0GRASFL = $0313DUPLEX = $12TEMPCH = $05TEMPCL = $06MULFIL = $C200RINPUT = $CF00ROUTPT = $CE00BUFEND = ROUTPTMULCNT = 2047MULFLN = 2046MLSALL = 2045MULSKP = 2044MAX    = $02BEGPOS = $07ENDPOS = $ACBUFFLG = $0BBUFFL2 = $0CBUFFOC = $10PNT10  = $0200PNT11  = $028DPNT12  = $029BPNT13  = $029CPNT14  = $02A1PBUF   = $1000PBUF2  = $0400XMOSCN = PBUF2CAN    = 24ACK    = 6NAK    = 21EOT    = 4SOH    = 1CPMEOF = 26CA = 193  ;CAP LETTERS!B  = 194C  = 195D  = 196E  = 197F  = 198G  = 199H  = 200I  = 201L  = 204O  = 207M  = 205N  = 206CP = 208Q  = 209CR = 210CS = 211T  = 212U  = 213V  = 214W  = 215CX = 216CY = 217Z  = 219;;COMMODORE COLOR GRAPHICS;MANIPULATION SYSTEM TERMINAL;BY CRAIG SMITH;;VERSION 5.5 -- JAN 1988;VERSION 5.0 -- JAN 1988;VERSION 4.5 -- MAY 1987;VERSION 4.1 -- OCT 1986;VERSION 4.0 -- DATE UNKNOWN; MODS BY GREG PFOUTZ,W/PERMISSION;VERSION 3.0 -- AUG 1985;*=$0801.BYT $0D,$08,$0A,00,$9E,$32,$30.BYT $36,$33,20,$39,00,00,00 JMP START;PUNTER ; SOURCE CODE $0812;REFERENCED BY OLD $C000 ADDRESSES*=$0812  ;PXXXXXP49152  LDA #$00 .BYT $2CP49155  LDA #$03 .BYT $2CP49158  LDA #$06 .BYT $2CP49161  LDA #$09 .BYT $2CP49164  LDA #$0C .BYT $2CP49167  LDA #$0F NOPP49170  JMP PNT23P49173  JMP PNT109PNT23 STA $62 TSX STX PBUF+28 LDA #<PNTTAB CLC ADC $62 STA PNTJMP+1 LDA #>PNTTAB ADC #$00 STA PNTJMP+2PNTJMP JMP PNTTABPNTTAB JMP PNT28 JMP PNT87 JMP PNT84 JMP PNT95 JMP PNT99 JMP PNT110PNT27 .BYT 'GOOBADACKS/BSYN'PNT28 STA PBUF+5 LDA #$00 STA PBUF STA PBUF+1 STA PBUF+2PNT29 LDA #$00 STA PBUF+6 STA PBUF+7PNT30 JSR PNT114 JSR PNT38 LDA $96 BNE PNT35 LDA PBUF+1 STA PBUF LDA PBUF+2 STA PBUF+1 LDA PNT10 STA PBUF+2 LDA #$00 STA PBUF+4 LDA #$01 STA PBUF+3PNT31 LDA PBUF+5 BIT PBUF+3 BEQ PNT33 LDY PBUF+4 LDX #$00PNT32 LDA PBUF,X CMP PNT27,Y BNE PNT33 INY INX CPX #$03 BNE PNT32 JMP PNT34PNT33 ASL PBUF+3 LDA PBUF+4 CLC ADC #$03 STA PBUF+4 CMP #$0F BNE PNT31 JMP PNT111PNT34 LDA #$FF STA PBUF+6 STA PBUF+7 JMP PNT30PNT35 INC PBUF+6 BNE PNT36 INC PBUF+7PNT36 LDA PBUF+7 ORA PBUF+6 BEQ PNT37 LDA PBUF+6 CMP #$07 LDA PBUF+7 CMP #$14 BCC PNT30 LDA #$01 STA $96 JMP PNT101PNT37 LDA #$00 STA $96 RTS NOPPNT38 JMP PNT122 NOP NOPPNT39 CMP PNT13 BEQ PNT40 LDY PNT13 LDA ($F7),Y PHA INC PNT13 LDA #$00 STA $96 PLA STA PNT10 PLA TAY JMP PNT41PNT40 LDA #$02 STA $96 LDA #$00 STA PNT10 PLA TAYPNT41 PHA LDA #$03 STA $BA PLA RTSPNT42 LDX #$05 JSR CHKOUT LDX #$00PNT43 LDA PNT27,Y JSR CHROUT INY INX CPX #$03 BNE PNT43 JMP PNT118PNT44 STA PBUF+8 LDA #$00 STA PBUF+11PNT45 LDA #$02 STA $62 LDY PBUF+8 JSR PNT42PNT46 LDA #$04 JSR PNT28 LDA $96 BEQ PNT47 DEC $62 BNE PNT46 JMP PNT45PNT47 LDY #$09 JSR PNT42 LDA PBUF+13 BEQ PNT48 LDA PBUF+8 BEQ PNT50PNT48 LDA PBUF2+4 STA PBUF+9 STA PBUF+23 JSR PNT65 LDA $96 CMP #$01 BEQ PNT49 CMP #$02 BEQ PNT47 CMP #$04 BEQ PNT49 CMP #$08 BEQ PNT47PNT49 RTSPNT50 LDA #$10 JSR PNT28 LDA $96 BNE PNT47 LDA #$0A STA PBUF+9PNT51 LDY #$0C JSR PNT42 LDA #$08 JSR PNT28 LDA $96 BEQ PNT52 DEC PBUF+9 BNE PNT51PNT52 RTSPNT53 LDA #$01 STA PBUF+11PNT54 LDA PBUF+30 BEQ PNT55 LDY #$00 JSR PNT42PNT55 LDA #$0B JSR PNT28 LDA $96 BNE PNT54 LDA #$00 STA PBUF+30 LDA PBUF+4 CMP #$00 BNE PNT59 LDA PBUF+13 BNE PNT61 INC PBUF+25 BNE PNT56 INC PBUF+26PNT56 JSR PNT79 LDY #$05 INY LDA ($64),Y CMP #$FF BNE PNT57 LDA #$01 STA PBUF+13 LDA PBUF+22 EOR #$01 STA PBUF+22 JSR PNT79 JSR PNT77 JMP PNT58PNT57 JSR PNT74PNT58 LDA #'-' .BYT $2CPNT59 LDA #':' JSR PNT107 LDY #$06 JSR PNT42 LDA #$08 JSR PNT28 LDA $96 BNE PNT58 JSR PNT79 LDY #$04 LDA ($64),Y STA PBUF+9 JSR PNT80 LDX #$05 JSR CHKOUT LDY #$00PNT60 LDA ($64),Y JSR PNT123 INY CPY PBUF+9 BNE PNT60 JSR CLRCHN LDA #$00 RTSPNT61 LDA #'*' JSR PNT107 LDY #$06 JSR PNT42 LDA #$08 JSR PNT28 LDA $96 BNE PNT61 LDA #$0A STA PBUF+9PNT62 LDY #$0C JSR PNT42 LDA #$10 JSR PNT28 LDA $96 BEQ PNT63 DEC PBUF+9 BNE PNT62PNT63 LDA #$03 STA PBUF+9PNT64 LDY #$09 JSR PNT42 LDA #$00 JSR PNT28 DEC PBUF+9 BNE PNT64 LDA #$01 RTSPNT65 LDY #$00PNT66 LDA #$00 STA PBUF+6 STA PBUF+7PNT67 JSR PNT114 JSR PNT38 LDA $96 BNE PNT70 LDA PNT10 STA PBUF2,Y CPY #$03 BCS PNT68 STA PBUF,Y CPY #$02 BNE PNT68 LDA PBUF CMP #$41 BNE PNT68 LDA PBUF+1 CMP #$43 BNE PNT68 LDA PBUF+2 CMP #$4B BEQ PNT69PNT68 INY CPY PBUF+9 BNE PNT66 LDA #$01 STA $96 RTSPNT69 LDA #$FF STA PBUF+6 STA PBUF+7 JMP PNT67PNT70 INC PBUF+6 BNE PNT71 INC PBUF+7PNT71 LDA PBUF+6 ORA PBUF+7 BEQ PNT73 LDA PBUF+6 CMP #$06 LDA PBUF+7 CMP #$10 BNE PNT67 LDA #$02 STA $96 CPY #$00 BEQ PNT72 LDA #$04 STA $96PNT72 JMP PNT101PNT73 LDA #$08 STA $96 RTSPNT74 LDA PBUF+22 EOR #$01 STA PBUF+22 JSR PNT79 LDY #$05 LDA PBUF+25 CLC ADC #$01 STA ($64),Y INY LDA PBUF+26 ADC #$00 STA ($64),Y LDX #$02 JSR CHKIN LDY #$07PNT75 JSR CHRIN STA ($64),Y INY JSR READST BNE PNT76 CPY PBUF+24 BNE PNT75 TYA PHA JMP PNT78PNT76 TYA PHA LDY #$05 INY LDA #$FF STA ($64),Y JMP PNT78PNT77 PHAPNT78 JSR CLRCHN JSR PNT109 JSR PNT103 JSR PNT109 LDY #$04 LDA ($64),Y STA PBUF+9 JSR PNT80 PLA LDY #$04 STA ($64),Y JSR PNT81 RTSPNT79 LDA #<PBUF2 STA $64 LDA PBUF+22 CLC ADC #>PBUF2 STA $65 RTSPNT80 LDA #<PBUF2 STA $64 LDA PBUF+22 EOR #$01 CLC ADC #>PBUF2 STA $65 RTSPNT81 LDA #$00 STA PBUF+18 STA PBUF+19 STA PBUF+20 STA PBUF+21 LDY #$04PNT82 LDA PBUF+18 CLC ADC ($64),Y STA PBUF+18 BCC PNT83 INC PBUF+19PNT83 LDA PBUF+20 EOR ($64),Y STA PBUF+20 LDA PBUF+21 ROL A ROL PBUF+20 ROL PBUF+21 INY CPY PBUF+9 BNE PNT82 LDY #$00 LDA PBUF+18 STA ($64),Y INY LDA PBUF+19 STA ($64),Y INY LDA PBUF+20 STA ($64),Y INY LDA PBUF+21 STA ($64),Y RTSPNT84 LDA #$00 STA PBUF+13 STA PBUF+12 STA PBUF+29 LDA #$01 STA PBUF+22 LDA #$FF STA PBUF+25 STA PBUF+26 JSR PNT80 LDY #$04 LDA #$07 STA ($64),Y JSR PNT79 LDY #$05 LDA #$00 STA ($64),Y INY STA ($64),YPNT85 JSR PNT53 BEQ PNT85PNT86 LDA #$00 STA PNT10 RTSPNT87 LDA #$01 STA PBUF+25 LDA #$00 STA PBUF+26 STA PBUF+13 STA PBUF+22 STA PBUF2+5 STA PBUF2+6 STA PBUF+12 LDA #$07 STA PBUF2+4 LDA #$00PNT88 JSR PNT44 LDA PBUF+13 BNE PNT86 JSR PNT93 BNE PNT92 JSR CLRCHN LDA PBUF+9 CMP #$07 BEQ PNT90 LDX #$02 JSR CHKOUT LDY #$07PNT89 LDA PBUF2,Y JSR CHROUT INY CPY PBUF+9 BNE PNT89 JSR CLRCHNPNT90 LDA PBUF2+6 CMP #$FF BNE PNT91 LDA #$01 STA PBUF+13 LDA #'*' .BYT $2CPNT91 LDA #'-' JSR GOOBAD JSR PNT109 LDA #$00 JMP PNT88PNT92 JSR CLRCHN LDA #':' JSR GOOBAD LDA PBUF+23 STA PBUF2+4 LDA #$03 JMP PNT88PNT93 LDA PBUF2 STA PBUF+14 LDA PBUF2+1 STA PBUF+15 LDA PBUF2+2 STA PBUF+16 LDA PBUF2+3 STA PBUF+17 JSR PNT79 LDA PBUF+23 STA PBUF+9 JSR PNT81 LDA PBUF2 CMP PBUF+14 BNE PNT94 LDA PBUF2+1 CMP PBUF+15 BNE PNT94 LDA PBUF2+2 CMP PBUF+16 BNE PNT94 LDA PBUF2+3 CMP PBUF+17 BNE PNT94 LDA #$00 RTSPNT94 LDA #$01 RTSPNT95 LDA #$00 STA PBUF+25 STA PBUF+26 STA PBUF+13 STA PBUF+22 STA PBUF+12 LDA #$07 CLC ADC #$01 STA PBUF2+4 LDA #$00PNT96 JSR PNT44 LDA PBUF+13 BNE PNT98 JSR PNT93 BNE PNT97 LDA PBUF2+7 STA PBUF+27 LDA #$01 STA PBUF+13 LDA #$00 JMP PNT96PNT97 LDA PBUF+23 STA PBUF2+4 LDA #$03 JMP PNT96PNT98 LDA #$00 STA PNT10 RTSPNT99 LDA #$00 STA PBUF+13 STA PBUF+12 LDA #$01 STA PBUF+22 STA PBUF+29 LDA #$FF STA PBUF+25 STA PBUF+26 JSR PNT80 LDY #$04 LDA #$07 CLC ADC #$01 STA ($64),Y JSR PNT79 LDY #$05 LDA #$FF STA ($64),Y INY STA ($64),Y LDY #$07 LDA PBUF+27 STA ($64),Y LDA #$01 STA PBUF+30PNT100 JSR PNT53 BEQ PNT100 LDA #$00 STA PNT10 RTSPNT101 INC PBUF+12 LDA PBUF+12 CMP #$03 BCC PNT102 LDA #$00 STA PBUF+12 LDA PBUF+11 BEQ PNT103 BNE PNT106PNT102 LDA PBUF+11 BEQ PNT106PNT103 LDX #$00PNT104 LDY #$00PNT105 INY BNE PNT105 INX CPX #$78 BNE PNT104PNT106 RTSPNT107 PHA LDA PBUF+25 ORA PBUF+26 BEQ PNT108 LDA PBUF+29 BNE PNT108 PLA JSR GOOBAD PHAPNT108 PLA RTSPNT109 JSR $EF7E LDA PNT14 CMP #$80 BEQ PNT109 CMP #$92 BEQ PNT109 RTSPNT110 RTSPNT111 LDX #$00PNT112 LDA PBUF2,X CMP #$0D BNE PNT113 INX CPX #$03 BCC PNT112 JMP PNT120PNT113 JMP PNT29PNT114 LDA PNT11 CMP #$02 BNE PNT116PNT115 PLA TSX CPX PBUF+28 BNE PNT115PNT116 LDA #$01 STA PNT10PNT117 RTS BRKPNT118 JSR CLRCHNPNT119 LDA $DD01 AND #$00   ;AND #$10 FOR CARRIER BEQ PNT117 ;CHECK AND ABORTPNT120 TSX CPX PBUF+28 BEQ PNT121 PLA SEC BCS PNT120PNT121 LDA #$80 STA PNT10 JSR CLRCHN RTSPNT122 TYA PHA JSR PNT119 LDA PNT12 JMP PNT39PNT123 PHA JSR PNT119 PLA JMP CHROUT BRKPTRTXT .BYT 13,13,5,N,E,W,32,CP,'UNTER ',00UPLTXT .BYT U,'P',00DOWTXT .BYT D,'OWN',00LODTXT .BYT 'LOAD.',13,00FLNTXT .BYT E,'NTER FILENAME: ',00XFRMED .BYT 13,158,32,32,0XFRTXT .BYT 'LOADING: ',159,0XF2TXT .BYT 13,5,'  (',CP,'RESS ',C,'= TO ABORT.)',13,13,00ABRTXT .BYT CA,'BORTED.',13,00MRGTXT .BYT 153,32,G,'OOD ',B,'LOCKS: ',5,'000',5,'   -   ' .BYT 153,B,'AD ',B,'LOCKS: ',5,'000',13,0GFXTXT .BYT 153,G,'RAPHICS',00ASCTXT .BYT 159,CA,CS,C,I,I,00RDYTXT .BYT ' ',T,'ERMINAL ',CR,'EADY.',155,13,13,00DSCTXT .BYT 13,5,D,'ISCONNECTED.',13,13,0DRTYPE .BYT 'D','S','P','U','R'DRTYP2 .BYT 'E','E','R','S','E'DRTYP3 .BYT 'L','Q','G','R','L'DRFORM .BYT 158,2,157,157,5,6,32,159,14,153,32,63,32,0;*=$1020;START OF TERMINAL PROGRAMSTART.BYT $AF,$F1,$E4,$AB,$FF,$18,$8B,>DUMMYB,$44,$4C,$48,$A9,<DUMMYB,$7A.BYT $48,$A9,<DECODE,$8F,$FF,$02,$3C,$78,$40,$A9,>DECODE,$8F,$00.BYT $02,$E2,$41,$6C,$FF,$02DUMMYB .BYT 0STADEC SEI LDA #<DISNMI STA NMIVEC LDA #>DISNMI STA NMIVEC+1 CLD LDX #$FF TXS LDA #$2F STA $00 LDA #$37 STA $01 LDA #1 STA 204 LDA #BCOLOR  ;SETTUP STA BACKGR STA BORDER LDA #TCOLOR STA TEXTCL LDA #$80 STA 650      ;RPT LDA #$0E STA $D418 LDA #$00 STA LOCAT LDA #$E0       ;CLEAR SECONDARY STA LOCAT+1    ;SCREENS LDA #$20 LDY #$00ERASL1 STA (LOCAT),Y INY BNE ERASL1 INC LOCAT+1 BNE ERASL1 CLI LDA $BA        ;CURRENT DEV# CMP #$08 BCC STODEV CMP #$0C BCC STODV2STODEV LDA #$08STODV2 STA DISKDV CMP #$08 BEQ STODV3 JSR DRVCHK BMI STODEVSTODV3 LDA #<ENDPRG   ;SET BUFFER START STA BUFFST LDA #>ENDPRG STA BUFFST+1 LDA NEWBUF     ;INIT. BUFFER STA BUFPTR     ;& OPEN RS232 LDA NEWBUF+1 STA BUFPTR+1 JSR RSOPEN JMP INITRSOPEN          ;OPEN RS232 FILE JSR CLALL LDA #LOGNUM LDX #MODEM LDY #SECADR JSR SETLFS LDA PROTOE LDX #<PROTO LDY #>PROTO JSR SETNAM JSR OPEN LDA #>RINPUT  ;MOVE RS232 BUFFERS STA 248       ;SO THEY DON'T LDA #>ROUTPT  ;OVERLAP TERMBUFFER STA 250ERCOPN LDA #$02       ;OPEN ERR CHAN LDX #<DRESET LDY #>DRESET JSR SETNAM LDA #15 LDX DISKDV TAY JSR SETLFS JMP OPENINIT JSR SELMDM LDA #1 STA CURSFL     ;NON-DESTRUCTIVE LDA #0 STA $9D ;PRG MODE STA GRASFL     ;GRAFIX MODE STA ALLCAP     ;UPPER/LOWER STA BUFFOC     ;BUFF CLOSED STA DUPLEX     ;FULL DUPLEX LDA ALRLOD BNE NOLOAD JSR $E544  ;CLR LDA #1 STA ALRLOD LDX #<CONFFN LDY #>CONFFN LDA #11 JSR SETNAM LDA #2 LDX DISKDV LDY #0 JSR SETLFS JSR LOADCF JMP BEGINNOLOAD JSR BAUDBEGIN JSR BELLTERM JSR MSSG       ;TITLE SCREEN JSR INSTR JMP MAINPROTO  .BYT $08   ;START WITHPROTO1 .BYT $00   ;1200 BAUD SETNGBDOUTL .BYT $51BDOUTH .BYT $0DPROTOE .BYT $02 ;LENGTH OF PROTODRESET .BYT 'U9'DISKDV .BYT $08ALLCAP .BYT 0ALRLOD .BYT 0LASTCH .BYT 0NEWBUF .BYT <ENDPRG,>ENDPRGMAIN LDX #$FF TXS LDA #$48 STA 655 LDA #$EB STA 656 JSR CLRCHN JSR CURPRTMAIN2 LDA BUFPTR STA NEWBUF LDA BUFPTR+1 STA NEWBUF+1 JSR CLRCHN JSR GETIN CMP #$00 BNE SPECCKMAINAB JMP MAIN3;CHECK SPECIAL-KEYS HERESPECCK CMP #6 BNE SPECC1 LDX 653 CPX #6 BNE SPECC1 LDX #16 STX DATDIR LDX #0 STX MODREG JMP MAIN2SPECC1 CMP #'_' BNE CHKSCR LDX 653     ;SHIFT _ TOGGLES BEQ CHECKF  ;N/D CURSOR CPX #1 BEQ SPETOG LDA ALLCAP EOR #$01 STA ALLCAP JMP MAIN2SPETOG JMP CRSRTG;CHKSCR LDX 653 CPX #$05    ;SHIFT-CTRL AND 1-4 BCC CHEKRS  ;TOGGLE SCREEN LDX #$03CHKSC1 CMP CLCODE,X ;TABLE OF COLOR CODES BEQ CHKSC2 DEX BPL CHKSC1 JMP MAIN3   ;(NOT IN RANGE)CHKSC2 JMP SCRTOG  ;X HOLDS POS 0-3;CHEKRS CMP #131    ;SHIFT-R/S BNE CHECKF  ;TO HANG-UP JMP HANGUPCHECKF       ;F-KEYS CMP #133 BCC NOTFKY CMP #141 BCS NOTFKY LDX #0 STX $D020 STX $D021 PHA JSR CUROFF PLA SEC SBC #133 STA $03 ASL $03 CLC ADC $03 STA FBRANC+1 CLCFBRANC BCC FBRANC+2 JMP F1 JMP F3 JMP F5 JMP F7 JMP F2 JMP F4 JMP F6 JMP F8NOTFKY LDX ALLCAP BEQ UPPLOW LDX 53272 CPX #23 BNE UPPLOW CMP #'A' BCC UPPLOW CMP #'['  ;'Z'+1 BCS UPPLOW ORA #$80UPPLOW STA $03 LDX GRASFL BEQ MAINOP JSR CATOSA  ;CONVERT TO ASCII BNE MAINOPMNBACK JMP MAIN2MAINOP PHA LDX #LOGNUM JSR CHKOUT PLA JSR CHROUT LDX GRASFL BEQ MAING JSR SATOCA STA $03 BNE MAING JMP MAIN2MAING LDX DUPLEX BEQ MAIN3 JSR CLRCHN  ;IF HALF DUPLEX LDA $03     ;BRING BACK CHAR LDX GRASFL BEQ MAINB CMP #'_' BNE MAINB LDA #164    ;ECHO UNDERLINE FOR STA $03     ;_ IN ASCII/HALF DUPMAINB JMP BUFCHK  ;SKIP MODEM INPUTMAIN3 JSR CLRCHN LDX 653 CPX #4   ;CTRL PRESSED BNE SPECC2 LDX 197  ;FN KEY CPX #3 BCC SPECC2 CPX #7 BCS SPECC2 LDA #0 STA MACMDM JSR PRTMAC JMP MAINSPECC2 CPX #3 ;SHIFT,C= BNE SPECC3 LDX 657 BPL SPECC3 LDX #23 STX 53272SPECC3 LDX #LOGNUM JSR CHKIN JSR GETIN CMP #$00 BEQ MNBACK LDX STATUS BNE MNBACK PHA JSR CLRCHN PLANOPASS LDX GRASFL BEQ MAIN4 JSR SATOCA   ;ASCII TO C= BEQ MAIN3MAIN4 CMP #20      ;DELETE FROM MODEM BNE BUFCHK   ;BECOMES FALSE DEL LDA #'_'BUFCHK JSR PUTBUF JMP CONTNPUTBUF LDX BUFFOC BEQ BUFFOT LDX BUFPTR CPX #<BUFEND BNE BUFOK LDX BUFPTR+1 CPX #>BUFEND BEQ BUFFOTBUFOK LDY #$00 STA (BUFPTR),Y INC BUFPTR BNE BUFFOT INC BUFPTR+1BUFFOT RTSCONTN JSR CTRLCK BCC CONTN2 JMP MAINCTRLCK CMP #$0A   ;CTRL-J BEQ SWCRSR CMP #$0B   ;CTRL-K BNE NONCHKSWCRSR LDX GRASFL BNE NONCHK PHA JSR CUROFF PLA AND #$01   ;FORM TO CH FLAG EOR #$01 STA CURSFLSWCEXT SEC RTSNONCHK CMP #14  ;CTRL-N BNE CTRLEN LDX #0 STX $D020 STX $D021CTRLEN CMP #$07   ;CTRL-G BNE CTRLEO JSR BELLCTRLEO CMP #22   ;CTRL-V BNE CTRLEV JSR GONGCTRLEV CMP #$15   ;CTRL-U BNE CTRLE2 LDX #21 STX 53272 BNE CTRLEXCTRLE2 CMP #$0C   ;CTRL-L BNE CTRLE3 LDX #23 STX 53272 BNE CTRLEXCTRLE3 CMP #'_'   ;FALSE DEL BNE CTRLE4 ;(BUFF AND 1/2 DUPLX) LDA #20 BNE CTRLEXCTRLE4 LDX LASTCH CPX #2  ;CTRL-B BNE CTRLEX LDX #15CTRLB1  CMP CLCODE,X BEQ CTRLB2 DEX BPL CTRLB1 BMI CTRLEXCTRLB2 STX $D020 STX $D021 LDA #16  ;CTRL-P..NON PRINTABLECTRLEX STA LASTCH CLC RTSCONTN2 PHA JSR CUROFF  ;GET RID OF CURSOR PLA JSR CHROUT JSR QIMOFF JMP MAIN;;END OF TERM;SUBROUTINES FOLLOW:;BELL LDX #$09 STX 54291 LDX #00 STX 54292 LDX #$40 STX 54287 LDX #00 STX 54290 LDX #$11 STX 54290 RTSGONGM1 .BYT 24,6,13,20,4,11,18,15,8,1,5,19,12,14,7,0,4,11,18,24GONGM2 .BYT 47,0,0,0,0,0,0,4,8,16,13,13,11,28,48,68,21,21,21,15GONG PHA LDX #0GONG1 LDA GONGM1,X TAY LDA GONGM2,X STA 54272,Y INX CPX #20 BCC GONG1 PLA RTSSCRTOG   ;TOGGLE SCREEN #1-4 TXA     ;(SWAP SCREEN MEMORY WITH PHA     ; BEHIND KERNAL ROM) JSR CUROFF LDA 653 STA $04 PLA ASL A ASL A ASL A CLC ADC #$E0 STA LOCAT+1 LDA #$04 STA $03 LDA #$00 STA LOCAT STA $02 SEI LDA $D011 PHA LDA #$0B STA $D011 LDA #<RAMNMI STA $FFFA LDA #>RAMNMI STA $FFFB LDA #$2F STA $00 LDA #$35 STA $01SCRTG1 JSR SCRNL1 CMP #$08 BCC SCRTG1 LDA #$D8 STA $03SCRTG2 JSR SCRNL1 CMP #$DC BCC SCRTG2 PLA STA $D011 LDA #$37 STA $01 CLI JMP MAINRAMNMI STA TEMPCH LDA #$37 STA $01 PLP PHP STA TEMPCL LDA #>RAMNM2 PHA LDA #<RAMNM2 PHA LDA TEMPCL PHA LDA TEMPCH JMP $FE43RAMNM2 PHA LDA #$35 STA $01 PLA RTISCRNL1 LDX $04 CPX #05 BEQ SCRNLS LDY #0SCRNLC  LDA ($02),Y STA (LOCAT),Y DEY BNE SCRNLC BEQ SCRNL3SCRNLS  LDY #$00SCRNL2  ;SWAP SCREEN PAGE LDA ($02),Y TAX LDA (LOCAT),Y STA ($02),Y TXA STA (LOCAT),Y INY BNE SCRNL2SCRNL3  LDA #<RAMNMI STA $FFFA LDA #>RAMNMI STA $FFFB INC LOCAT+1 INC $03 LDA $03 RTSOUTSPC LDA #29   ;CRSR RIGHTOUTSP1 JSR CHROUT DEX BNE OUTSP1 RTSBUFCLR LDA BUFFST STA BUFPTR LDA BUFFST+1 STA BUFPTR+1 RTSFINPOS ;CALCULATE SCREENPOS LDY LINE LDA $ECF0,Y STA LOCAT LDA $D9,Y AND #$7F STA LOCAT+1 LDA COLUMN CMP #40 BCC FINP2 SBC #40 CLCFINP2 ADC LOCAT STA LOCAT LDA LOCAT+1 ADC #$00 STA LOCAT+1 LDY #$00 LDA (LOCAT),Y RTSFINCOL   ;CALCULATE COLOR PTR JSR FINPOS LDA #$D4 CLC ADC LOCAT+1 STA LOCAT+1 LDA (LOCAT),Y RTSQIMOFF   ;TURN QUOTE/INSERT OFF LDA #$00 STA QMODE STA IMODE RTSMSSG LDA #<MSGTXT LDY #>MSGTXT JSR OUTSTR LDA #32 JSR CHROUT LDX #18 LDA #163MSLOP1 JSR CHROUT DEX BNE MSLOP1 LDA #<AUTHOR LDY #>AUTHOR JSR OUTSTR LDX #40MSLOP2 LDA #183 JSR CHROUT DEX BNE MSLOP2 RTSINSTR LDA #<INSTXT LDY #>INSTXT JSR OUTSTR LDA #<INSTX2 LDY #>INSTX2 JSR OUTSTRTRMTYP LDX GRASFL BNE ASCTRM LDA #<GFXTXT LDY #>GFXTXT BNE TERMTPASCTRM LDA #<ASCTXT LDY #>ASCTXTTERMTP JSR OUTSTR LDA #<RDYTXT LDY #>RDYTXT JMP OUTSTRMSGTXT.BYT 13,$93,8,5,14,18,32,28,32,C,32,129,32,C,32,158,32,G,32,30.BYT 32,M,32,31,32,CS,32,156,' ! ',5,32.BYT ' ',T,'ERMINAL ',V,'ERS 5.5  ',00AUTHOR  .BYT '    BY ',C,'RAIG ',CS,'MITH   ',146,151,00;INSTXT.BYT 5,'  ',18,F,'1',146,32,150,U,'PLOAD          '.BYT 5,18,F,'2',146,32,150,CS,'END/',CR,'EAD FILE',13.BYT 5,'  ',18,F,'3',146,32,158,D,'OWNLOAD        '.BYT 5,18,F,'4',146,32,158,B,'UFFER COMMANDS',13.BYT 5,'  ',18,F,'5',146,32,153,D,'ISK ',C,'OMMAND    '.BYT 5,18,F,'6',146,32,153,D,'IRECTORY',13.BYT 5,'  ',18,F,'7',146,32,30,D,'IALER/',CP,'ARAMS   '.BYT 5,18,F,'8',146,32,30,CS,'WITCH TERMS',13,0INSTX2.BYT 31,C,28,'=',5,18,F,'1',146,32,159,M,'ULTI-',CS,'END    '.BYT 31,C,28,'=',5,18,F,'3',146,32,159,M,'ULTI-',CR,'ECEIVE',13.BYT 31,C,28,'=',5,18,F,'5',146,32,154,CS,'END ',D,'IR.     '.BYT 31,C,28,'=',5,18,F,'7',146,32,154,CS,'CREEN TO ',B,'UFF.',13,13,0;MLSWRN .BYT 13,5,B,'UFFER TOO BIG - ',CS,'AVE OR ',C,'LEAR FIRST!',13,0;DIRMDM .BYT 0;DIRECTORY ROUTINEDIRFN   .BYT '$'DIR LDA #$0D LDX DISKDV LDY #$00 JSR SETLFS JSR DRVCHK BPL DIRST JMP DREXITDIRST JSR CLRCHN JSR COSAVE LDA #$0D JSR CHROUT JSR OPEN LDA #0 STA DIRMDM LDA 653 CMP #2   ;C= F6 BNE DIRLP0 LDA #1 STA DIRMDMDIRLP0 LDX #$0D JSR CHKIN LDY #03DRLP1 JSR GETCH DEY BPL DRLP1 JSR GETCH STA $0B JSR GETCH LDX $0B JSR OUTNUM LDA #' ' JSR CHROUTDRLP2 JSR GETCH LDX DIRMDM BEQ DRLPM CMP #0 BEQ DRLPM2 CMP #' ' BCC DRLP2DRLPM JSR CHROUT BNE DRLP2DRLPM2 JSR DRRET LDY #01 BNE DRLP1GETCH JSR GETIN LDX STATUS BNE DRLP3 CMP #00 RTSDRLP3 PLA PLADREXIT JSR CLRCHN JSR COBACK LDA #$0D JSR CHROUT JMP CLOSEDRRET LDA #$0D JSR CHROUT JSR CLRCHN JSR GETIN BEQ DRCONT CMP #$03 BEQ DRLP3 LDA #$00 STA $C6DRWAIT JSR GETIN BEQ DRWAITDRCONT LDX DIRMDM BEQ DIRCOE LDA #145 JSR CHROUT LDA #3  ;SCREEN STA 153 ;DEF INPUT DEV LDX #5 JSR CHKOUT LDY #0DRCON2 JSR GETIN JSR CHROUT LDA #$FD STA $A2DRCODL LDA $A2 BNE DRCODL INY CPY #27 BCC DRCON2 LDA #$0D JSR CHROUT JSR CLRCHN LDA #$0D JSR CHROUT LDX #5 JSR CHKINDRCON3  JSR GETIN LDA $029B CMP $029C BNE DRCON3DIRCOE JSR CLRCHN LDX #$0D JMP CHKINDRVCHK LDA #00 STA STATUS LDA DISKDV JSR $ED0C LDA #$F0 JSR $EDBB LDX STATUS BMI DRC2 JSR $F654 LDA #$00DRC2  RTS;CONVERT STANDARD ASCII TO C= ASCIISATOCA CMP #'_' BNE CLAB0 LDA #164  ;UNDERLINE BNE CEXITCLAB0 AND #127 CMP #124 BCS CEXIT CMP #96 BCC CLAB1 SBC #32 BNE CEXITCLAB1 CMP #65 BCC CLAB2 CMP #91 BCS CEXIT ADC #128 BNE CEXITCLAB2 CMP #08 BNE CLAB3 LDA #20CLAB3 CMP #12 BNE CLAB4 LDA #$93CLAB4 CMP #32     ;DON'T ALLOW HOME, BCS CEXIT   ;CD, OR CR CMP #07 BEQ CEXIT CMP #$0D BEQ CEXIT CMP #20 BEQ CEXIT BNE CERRCCEXIT CMP #$00 RTSCERRC LDA #$00 BEQ CEXIT;CONVERT C= ASCII TO STANDARD ASCIICATOSA CMP #20 BNE ALAB0 LDA #08    ;DELETE BNE AEXITALAB0 CMP #164 ;UNDERLINE BNE ALAB1 LDA #'_'ALAB1  CMP #65 BCC CEXIT  ;IF<THEN NO CONV CMP #91 BCS ALAB2 ADC #32    ;LOWER A...Z..._ BNE AEXITALAB2  CMP #160 BNE ALAB3 LDA #32    ;SHIFT TO SPACE BNE AEXITALAB3  AND #127 CMP #65 BCC CERRC CMP #96    ;UPPER A...Z BCS CERRCAEXIT   CMP #$00 RTSSAVECH JSR FINPOS STA TEMPCH EOR #$80 STA (LOCAT),Y JSR FINCOL STA TEMPCL LDA TEXTCL STA (LOCAT),Y RTSRESTCH  ;RESTORE CHAR UND NON-CRSR JSR FINPOS LDA TEMPCH STA (LOCAT),Y JSR FINCOL LDA TEMPCL STA (LOCAT),Y RTSSPLEFT  ;OUTPUT SPACE, CRSRLEFT LDA #' ' JSR CHROUT LDA #LEFT JMP CHROUTCUROFF LDX CURSFL BNE RESTCH JSR QIMOFF JMP SPLEFTCURPRT LDA CURSFL BNE NONDST LDA #CURSOR JSR CHROUT LDA #LEFT JMP CHROUTNONDST JMP SAVECHINPUT JSR INPSET JMP INPUTLINPSET STX MAX CMP #$00 BEQ INPCON JSR OUTSTRINPCON JSR CLRCHN SEC JSR PLOT STX $9E STY $9F JSR FINPOS    ;SET UP BEGIN & LDA LOCAT+1   ;END OF INPUT STA BEGPOS+1  ;PTRS STA ENDPOS+1 LDA LOCAT STA BEGPOS CLC ADC MAX STA ENDPOS LDA ENDPOS+1 ADC #$00 STA ENDPOS+1 RTSINPUTL LDA #0 STA 204 JSR SAVECHINPWAT JSR GETIN BEQ INPWAT STA $03 AND #127 CMP #17 BEQ INPCUD CMP #34 BEQ INPWAT CMP #13 BNE INPWT1 JMP INPRETINPWT1 LDA $03 CMP #20 BEQ INPDEL CMP #157 BEQ INPDEL AND #$7F CMP #19 BEQ INPCLS BNE INPPRCINPCUD JSR RESTCH LDA $03 CMP #145 BEQ INPHOM JSR INPCU1 JMP INPMOVINPCU1 LDY MAXINPCU2 DEY BMI INPCU3 LDA (BEGPOS),Y CMP #' ' BEQ INPCU2INPCU3 INY TYA CLC ADC $9F TAY RTSINPCLS JSR RESTCH LDA $03 CMP #$93 BNE INPHOM LDY MAX LDA #' 'INPCL2 STA (BEGPOS),Y DEY BPL INPCL2INPHOM LDY $9FINPMOV LDX $9E CLC JSR PLOT JMP INPUTLINPDEL JSR FINPOS LDA LOCAT CMP BEGPOS BNE INPRST LDA LOCAT+1 CMP BEGPOS+1 BEQ INPWAT BNE INPRSTINPPRC JSR FINPOS LDA LOCAT CMP ENDPOS BNE INPINS LDA LOCAT+1 CMP ENDPOS+1 BNE INPINS JMP INPWATINPINS LDA $03 CMP #148 BNE INPRST DEC ENDPOS+1 LDY #$FF LDA (ENDPOS),Y INC ENDPOS+1 CMP #' ' BEQ INPRST JMP INPWATINPRST LDX #$03 STX 651 JSR RESTCH LDA $03 JSR CHROUT JSR QIMOFF JMP INPUTLINPRET JSR RESTCH JSR INPCU1 CMP 211 BCC INPRE2 LDX $9E CLC JSR PLOTINPRE2 JSR FINPOS LDA LOCAT SEC SBC BEGPOS PHA TAY LDA #' 'INPSPC STA (BEGPOS),Y CPY MAX BEQ INPINP INY BNE INPSPCINPINP PLA STA MAX LDX $9E LDY $9F CLC JSR PLOT LDA #1 STA 204 LDA #$03 LDY #$00 TAX JSR SETLFS LDA #$00 JSR SETNAM JSR OPEN LDX #$03 JSR CHKIN LDY #$00INPSTO CPY MAX BEQ INPEND JSR CHRIN STA INPBUF,Y INY BNE INPSTOINPEND LDA #$00 STA INPBUF,Y JSR CLRCHN LDA #$03 JSR CLOSE LDX MAX RTSCOSAVE LDX TEXTCL STX $04COCHNG LDX #TCOLOR STX TEXTCL RTSCOBACK LDX $04 STX TEXTCL RTSF6      ;DIRECTORY LDA #$01 LDX #<DIRFN LDY #>DIRFNDODIR JSR SETNAM JSR DIR JMP MAINF8      ;TERM TOGGLE LDX 653 CPX #2 BNE TERMTG JMP CF7TERMTG LDA GRASFL EOR #$01 STA GRASFL JSR BELL JMP TERMCRSRTG     ;ASCII CRSR TOGGLE JSR CUROFF LDA CURSFL EOR #$01 STA CURSFL JMP MAINHANGUP     ;HANG UP PHONE LDX #$20 STX DATDIR LDX 653 CPX #2 BEQ PICKUP LDA MOPO2 STA MODREG JSR CUROFF LDA #<DSCTXT LDY #>DSCTXT JSR OUTSTR JMP MAINPICKUP LDA MOPO1 STA MODREG JSR CUROFF LDA #<PCKTXT LDY #>PCKTXT JSR OUTSTR JMP MAINPCKTXT .BYT 13,5,O,'FF-HOOK.',13,13,0DSKTXT .BYT 5,13,D,'ISK#'DSKTX2 .BYT '**>      ',157,157,157,157,157,157,00DSKDTX .BYT '8 9 1011'F5      ;DISK COMMAND JSR COSAVEDSKCMD LDA DISKDV AND #$07 ASL A TAY LDA DSKDTX,Y STA DSKTX2 LDA DSKDTX+1,Y STA DSKTX2+1 LDA #<DSKTXT LDY #>DSKTXT LDX #31 JSR INPUT BEQ DRVERR LDA INPBUF CMP #'#' BEQ CHGDEV JSR DRVCHK BMI DRVEXT LDA #$0D JSR CHROUT LDA INPBUF CMP #'$' BNE DRVSND LDA MAX LDX #<INPBUF LDY #>INPBUF JMP DODIRDRVSND LDX DISKDV STX 612  ;DEV# TABLE, LOG#15 LDX #$0F JSR CHKOUT LDX #$00DRVLOP LDA INPBUF,X JSR CHROUT INX CPX MAX BNE DRVLOP LDA #$0D JSR CHROUTDRVEXT JSR CLRCHN JSR COBACK LDA #$0D JSR CHROUT JMP MAINDRVERR JSR DRVCHK BMI DRVEXT JSR CLRCHN LDX #$0F JSR CHKINDRVER2 JSR GETINDRVER3 JSR CHROUT CMP #$0D BNE DRVER2 BEQ DRVEXTCHGDEV LDY #$01 LDX INPBUF,Y TXA AND #$0F CPX #'1' BNE CHGDV2 CLC ADC #$09CHGDV2   INY CLC ADC INPBUF,Y AND #$0F CMP #$08 BCC DRVEXT CMP #$0C BCS DRVEXT TAY LDA DISKDV PHA STY DISKDV STY 612 JSR DRVCHK BMI CHGDV3 PLA LDA #145 JSR CHROUT JMP DSKCMDCHGDV3 PLA STA DISKDV STA 612CHGDV4 LDA #' ' JSR CHROUT LDA #'-' JSR CHROUT LDA #' ' JSR CHROUT LDY #$00CHGDV5 LDA $A1D0,Y  ;DEVICE NOT PRESENT PHP AND #$7F JSR CHROUT PLP BMI CHGDV6 INY BNE CHGDV5CHGDV6 JMP DRVEXT;MACMDM .BYT 0MACXRG .BYT 0PRMACX ;FIND INDEX FOR MACRO CPX #3   ;FROM 197 F-KEY VALUE BNE PRMAX2 LDX #7PRMAX2 TXA SEC SBC #4  ;NOW A=0..3 FOR F1,3,5,7 LDX #5PRMAX3 ASL A DEX BPL PRMAX3  ;A=0,64,128,192 STA MACXRG RTSPRTMAC LDA 197 CMP #7 BCC PRTMAC JSR PRMACXPRTMC0 LDX MACXRG LDA MACMEM,X BEQ PRTMC4 PHA LDX MACMDM BNE PRTMC2 LDX #5 JSR CHKOUT PLA PHA LDX GRASFL BEQ PRTMC1 JSR CATOSAPRTMC1 JSR CHROUT JSR CLRCHN LDA #$FD STA $A2PRTMCD LDA $A2 BNE PRTMCD LDX #5 JSR CHKIN JSR GETIN CMP #$00 BNE PRTMCI LDX DUPLEX BEQ PRTMCA LDX GRASFL BEQ PRTMC2 PLA JSR CATOSA BNE PRTMCK BEQ PRTMC3PRTMCA  PLA BNE PRTMC3PRTMCI  TAX PLA TXAPRTMCK  LDX GRASFL BEQ PRTMCJ JSR SATOCAPRTMCJ PHAPRTMC2 JSR CUROFF PLA LDX MACMDM BNE PRTMCS JSR PUTBUFPRTMCS JSR CTRLCK BCS PRTMC3 JSR CHROUT JSR QIMOFF JSR CURPRTPRTMC3  INC MACXRG CMP #255 BNE PRTMC0PRTMC4 JMP CUROFF;STBRVS .BYT 0STBCOL .BYT 0STBXPS .BYT 0STBYPS .BYT 0STBMAX .BYT 0STBMAY .BYT 0CF7  ;SCREEN TO BUFFER LDA #0 STA 198 LDA #$F1 STA $A2SCNBF0  LDA $A2 BNE SCNBF0 JSR GETIN CMP #140 BNE SCNBFS JSR BUFCLRSCNBFS LDA BUFFOC PHA LDA #1 STA BUFFOC LDA #0 STA STBRVS LDA #255 STA STBCOL LDY #24 STY STBYPSSCNBF1  LDX #39 STX STBXPSSCNBF2  JSR FINSCP CMP #' ' BNE SCNBF3 DEC STBXPS BPL SCNBF2 DEC STBYPS BPL SCNBF1 JMP SCNBR4SCNBF3 LDA #$0D JSR PUTBUF LDA #$93 JSR PUTBUF LDA 53272 AND #2 LSR A LSR A ROR A EOR #$8E JSR PUTBUF LDA $D021 AND #15 BEQ SCNBNC TAX LDA CLCODE,X PHA LDA #2 JSR PUTBUF PLA JSR PUTBUFSCNBNC LDA #10 JSR PUTBUF LDA STBYPS STA STBMAY LDA #0 STA STBYPSSCNBNL LDA #39 STA STBXPSSCNBF4 JSR FINSCP CMP #' ' BNE SCNBF5 DEC STBXPS BPL SCNBF4 INC STBXPS JMP SCNBRTSCNBF5 LDA STBXPS STA STBMAX LDA #0 STA STBXPSSCNBF6 JSR FINSCP STA $02 JSR FINSCC STA $03 LDA $02 AND #$80 CMP STBRVS BEQ SCNBF7 LDA STBRVS EOR #$80 STA STBRVS ORA #18 EOR #$80 JSR PUTBUFSCNBF7 LDA $02 CMP #' ' BEQ SCNBF8 LDA $03 CMP STBCOL BEQ SCNBF8 TAX LDA CLCODE,X JSR PUTBUFSCNBF8 LDA $02 AND #$7F CMP #$7F BEQ SCNBF9 CMP #' ' BCS SCNB10SCNBF9 CLC ADC #$40 BNE SCNB11SCNB10 CMP #64 BCC SCNB11 ORA #$80SCNB11 JSR PUTBUF INC STBXPS LDA STBXPS CMP STBMAX BCC SCNBF6 BEQ SCNBF6SCNBRT LDA STBXPS CMP #40 BCS SCNBR2 LDA #$0D JSR PUTBUF LDA #0 STA STBRVSSCNBR2 INC STBYPS LDA STBYPS CMP STBMAY BEQ SCNBR3 BCS SCNBRESCNBR3  JMP SCNBNLSCNBRE LDX 646 LDA CLCODE,X JSR PUTBUFSCNBR4 PLA STA BUFFOC JMP MAIN;FINSCP LDY STBYPS LDA $ECF0,Y STA LOCAT LDA $D9,Y AND #$7F STA LOCAT+1 LDY STBXPS LDA (LOCAT),Y RTSFINSCC JSR FINSCP LDA LOCAT+1 CLC ADC #$D4 STA LOCAT+1 LDA (LOCAT),Y AND #15 RTS.FIL 5B.GS